# 埋点

需要将所有的上报逻辑抽象出来，允许上报不同的后端、格式

- 基础字段
- 业务字段
- 上报地址
- 上报格式

基础包实现上报行为的定义，由基础包拓展业务包，对应不同的环境，如 web、小程序、客户端。业务包实现上报的真实逻辑。

上报时，不同系统的上报需要隔离，例如 JS 中可以通过两个实例来上报。

如果上报中遇到相应框架的绑定，应该由对应项目自行实现，或者封装成 package，如对 vue、react 等库的绑定。

需要注意的有：

1. 登录用户的区分
2. 用户停留时长的统计
3. 不同子系统的重复上报处理（如 pv）

## 停留时长

页面停留时长是用来衡量用户粘性的重要指标。

页面失活: 表示页面隐藏/离开：

- Element 隐藏：如页面内部弹窗
- 浏览器/浏览器标签页隐藏：浏览器 tab 切换，窗口最小化，切换应用至后台
- 路由切换
- 离开页面： 关掉浏览器

页面激活: 表示页面显示/进入：

- 浏览器标签页或者浏览器应用显示
- 路由进入
- Element 显示

停留时长: 计算方式：（当前时间 - 本次页面激活时间）+ 上次停留时长

web 每次页面失活时上报累计停留时长，以 id 标志清洗数据

对应 API：

- visiblitychange
- intersectionObserver
- vue 生命周期
